target: 10.129.229.41

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 35:39:d4:39:40:4b:1f:61:86:dd:7c:37:bb:4b:98:9e (ECDSA)
|_  256 1a:e9:72:be:8b:b1:05:d5:ef:fe:dd:80:d8:ef:c0:66 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.18.0 (Ubuntu)

no useful UDP ports found

website has nothing but some html on the screen:
To raise an IT support ticket, please visit tickets.keeper.htb/rt/
http://tickets.keeper.htb/rt/
Using Best practical ticketing system

Found http://tickets.keeper.htb/m/
but it seems to be a mobile version

RT/4.4.4+dfsg-2ubuntu1 is the RT version

Directory enumeration finds:
/rt
/rte
/rtl
/rtf
and different file types for each path. none of these are accessible. rt/admin redirects back to login but it exists.

Wappalyzer did not find any results for this webpage

https://github.com/bestpractical/rt/releases
The RT releases shows that one of the versions close to 4.4.4 is vulnerable to timing side-channel attacks. Because
of this, I was able to enumerate the user root because it took about 30 milliseconds longer to return requests
over the other users.

Before using hydra, I tried some super basic default credentials, and with success:
root:password
root session cookie: a054dcc60425d611
These credentials worked for for the web app but not for SSH

Found a ticket with the user:
lnorgaard (Lisa Norgaard) : lnorgaard@keeper.htb
Found user creation history that shows their initial password was set to Welcome2023! 

Configuration revealed database information:
port: 3306
databaseName 'rtdb'
databaseUser 'rtuser'
databaseAdmin 'postgres'

Perl 5.34 and Apache 2.4.52 discovered

Tried adding a script but there is a CSRF protection in place that did not allow it. redirection
url brings a 404 error. Maybe a session cookie exploit would work? 

I try accessing the routes manually, but they all throw a 404 error. Not sure these functions even work.
Seems like all creation/deletion actions throw this CSRF error.

I've been trying to use ffuf to figure out if the next parameter is exploitable with LFI using the admin
session cookie, but only got a single result:

[Status: 200, Size: 4239, Words: 409, Lines: 154, Duration: 427ms]
| URL | http://tickets.keeper.htb/rt/NoAuth/Login.html?next=Copy of index.html
    * FUZZ: Copy of index.html

This didn't return anything useful. Tried multiple directory traversal attempts with the LFI as well,
but still nothing. Going to pivot and look for other vulnerabilities.

There's a scripts page where scripts can be created and ran. I was able to bypass CSRF using the redirection
url by manually typing the subdomain, but the scripts are not executing upon the actions I set.

Found out I can upload files to tickets and clicking the file launches it successfully. Going to try
uploading payloads.

Current session cookie: e8f59d857f1f803e3da935531f1df871

Didn't work when trying to access /l/ which seems to be a log storage directory location.
The directory creates a new session cookie upon every attempt. Trying to use root cookies from
/rt/ did not work to bypass the /l/ access denied restriction.

I spent hours trying to figure out why I could not exploit any entry points. I went back to HTB
and followed the "walkthrough" steps where you need to input the answers you find on your own. I noticed
the step I was on was the portion that required me to use the enumerated user's credentials to login to keeper.
But... wait a minute. I did try that. So I tried again on the website, no luck. Then, I tried SSH again,
no luck. I looked up the solution because I was desperate to just learn what I was doing wrong.
Upon reaching that part of the guide, I noticed they were able to login to this user's SSH. After some frustration,
I double checked the credentials and I realized I was typing in Welcome123! and not Welcome2023! #UserError

Now we have a successful ssh as lnorgaard and the user flag. Time to privilege escalate.

